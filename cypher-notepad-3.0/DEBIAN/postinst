#!/bin/bash
# postinst script for Cypher Notepad
#
# @modified by LeeDongGeon1996.
# @date 20.10.05
#
# see: dh_installdeb(1)
# 

set -e

# summary of how this script can be called:
#        * <postinst> `configure' <most-recently-configured-version>
#        * <old-postinst> `abort-upgrade' <new version>
#        * <conflictor's-postinst> `abort-remove' `in-favour' <package>
#          <new-version>
#        * <postinst> `abort-remove'
#        * <deconfigured's-postinst> `abort-deconfigure' `in-favour'
#          <failed-install-package> <version> `removing'
#          <conflicting-package> <version>
# for details, see http://www.debian.org/doc/debian-policy/ or
# the debian-policy package

case "$1" in
    configure)
        echo Adding shortcut to the menu


        xdg-desktop-menu install --novendor /opt/CypherNotepad/CypherNotepad.desktop


        if [ "false" = "true" ]; then
            echo Installing daemon
            cp /opt/CypherNotepad/cypher-notepad.init /etc/init.d/cypher-notepad

            if [ -x "/etc/init.d/cypher-notepad" ]; then
                update-rc.d cypher-notepad defaults

                if [ "false" = "true" ]; then
                    if which invoke-rc.d >/dev/null 2>&1; then
                        invoke-rc.d cypher-notepad start
                    else
                        /etc/init.d/cypher-notepad start
                    fi
                fi
	        fi

        fi
    ;;

    abort-upgrade|abort-remove|abort-deconfigure)
    ;;

    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

echo ""
echo -e "\033[1;33mCypher Notepad 3.0 has been successfully installed.\033[0m"
echo "==================================================="

# Users can remove bundled JRE if JRE is already installed on the system.
java_version=`java -version 2>&1 | grep 'java version' | awk 'NR==1{ gsub(/"/,""); print $3 }'`
if [ "$java_version" != "" ]
then
	echo "(Optional) Java ${java_version}, which is required to launch Cypher Notepad, is already installed on your system. You can save 193MB disk space on your computer by removing bundled JRE."
	bash /opt/CypherNotepad/scripts/remove_bundled_jre.sh
	echo ""
	echo "==================================================="
fi

echo "You can create shortcuts by running these commands:"
echo ""
echo -e "\033[0;47m\033[1;30m#CLI\033[0m"
echo "	echo \"alias cypher-notepad='bash /opt/CypherNotepad/CypherNotepadLauncher'\" >> ~/.bashrc"
echo "	source ~/.bashrc"
echo ""
echo -e "\033[0;47m\033[1;30m#GUI\033[0m"
echo "	cp /opt/CypherNotepad/CypherNotepad.desktop \${HOME}/CypherNotepad.desktop"
echo "	sudo chmod 755 \${HOME}/CypherNotepad.desktop"
echo ""
echo "==================================================="
echo "If you have any questions when using the program, please refer to our website:"
echo ""
echo "	https://cypher-notepad.github.io/"
echo ""
echo "Thank you for downloading Cypher Notepad :)"

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
